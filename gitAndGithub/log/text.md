{% from "common/macros.njk" import trail, bold_number, callout, hp_number, label, show_commit, show_git_term, show_git_term_tip, show_detour, show_exercise, show_git_tabs, show_git_tabs_from_text, show_hands_on_practical, show_head, show_lesson_intro, show_lesson_link, show_output, show_ref, show_resources, show_sidebar, show_tag, show_transformation_columns, show_under_the_hood with context %}

<span id="prereqs"></span>
<span id="outcomes">Able to view the revision graph, and changes included in each commit.</span>
<span id="title">{{ trail.usingRevisionHistory.lessons.log.title }}</span>

<div id="body">
{% call show_lesson_intro() %}
It is useful to be able to **visualise the commits timeline, aka the _revision graph_.**

{% endcall %}

**The Git data model consists of two types of entities: {{ show_git_term("objects") }} and {{ show_git_term("refs") }}** (short for _references_). In this lesson, you will encounter examples of both.

**A Git {{ show_git_term("revision graph") }} is a visualisation of a repo's revision history**, containing examples of both objects and refs. First, let us learn to work with simpler revision graphs consisting of one branch, such as the one given below.


{{ show_commit('C3') }}
{{ show_commit('C2') }}
{{ show_commit('C1', edge='') }}
<p/>

**Nodes in the revision graph represent commits.**

* **A commit is one of four main types of Git {{ show_git_term("objects") }}**. For completeness, the other three are:
  * **blob** (short for **binary large object**): stores the contents of a file
  * **tree**: represents a directory and records the hierarchy of its contents by referencing blobs and other trees
  * **tag** (specifically, _annotated_ tag): a label-like object that can store additional metadata and point to a specific commit
* **A commit is identified by its {{ show_git_term("SHA") }} value**. A SHA (Secure Hash Algorithm) value is a unique identifier generated by Git to represent each commit. It is produced by using SHA-1 (i.e., one of the algorithms in the SHA family of cryptographic hash functions) on the entire content of the commit. It's a 40-character hexadecimal string (e.g., `f761ea63738a67258628e9e54095b88ea67d95e2`) that acts like a fingerprint, ensuring that every commit can be referenced unambiguously.
* A commit is a full snapshot of the working directory, constructed based on the previous commit, and the  changes staged. That means **each commit (except the initial commit) is based on a another {{ show_git_term("'parent' commit") }}**. Some commits can have multiple parent commits -- we’ll cover that later.

**Edges in the revision graph represent links between a commit and its parent commit(s).** In some revision graph visualisations, you might see arrows (instead of lines) showing how each commit points to its parent commit.

{{ show_commit('C3', edge="↓") }}
{{ show_commit('C2', edge="↓") }}
{{ show_commit('C1', edge='') }}
<p/>

**Git uses refs to name and keep track of various points in a repository’s history.** These refs are essentially 'named-pointers' that can serve as bookmarks to reach a certain point in the revision graph using the ref name.

{{ show_commit('C3', desc=show_ref('master') + show_head()) }}
{{ show_commit('C2') }}
{{ show_commit('C1', edge='') }}
<p/>

In the revision graph above, there are two refs {{ show_ref('master') }} and &nbsp;{{ show_head()}}.

* {{ show_ref('master') }} is a {{ show_git_term("branch ref") }}. A branch points to the latest commit on a branch (in this visualisation, the commit shown alongside the ref is the one it points to i.e., `C3`). **When you create a new commit, the ref of the <tooltip content="the currently active branch">current</tooltip> branch moves to the new commit.**
* {{ show_head()}} is a special ref. Normally, it points to the current branch (in this example, it is pointing to the `master` branch), and moves together with the branch ref.

{{ show_commit('C3', desc=show_ref('master') + show_head() + show_ref('origin/master')) }}
{{ show_commit('C2') }}
{{ show_commit('C1', edge='') }}
<p/>

In the revision graph above, you see a third type of ref ({{ show_ref('origin/master') }}). This is a {{ show_git_term("remote-tracking branch") }} ref that represents the state of a corresponding branch in a remote repository (if you previously set up the branch to 'track' a remote branch). In this example, the `master` branch in the remote `origin` is also at the commit `C3` (which means you have not created new commits after you pushed to the remote).

If you now create a new commit `C4`, the state of the revision graph will be as follows:

{{ show_commit('#y#C4##', desc=show_ref('master')  + show_head(), style="primary") }}
{{ show_commit('C3', desc= show_ref('origin/master')) }}
{{ show_commit('C2') }}
{{ show_commit('C1', edge='') }}
<p/>

Explanation: When you create `C4`, the current branch `master` moves to `C4`, and `HEAD` moves along with it. However, the `master` branch in the remote `origin` remains at `C3` (because you have not pushed `C4` yet). The `origin/master` ref will move to `C4` after you push your repo to the remote again.

{% call show_hands_on_practical('View the revision graph')  %}

{{ hp_number(hop_target) }} **Use Git features to examine the revision graph of a simple repo.**

{{ hp_number(hop_preparation) }} For this, use a repo with just a few commits and only one branch for this hands-on practical.

{{ show_git_tabs('-view-rg-normal') }}

**Observe how the revision graph changes** as you add a commit, and push that commit to the remote repo.

For example, we can update the `fruits.txt` in the `things` repo as follows, and commit it with the message `Update fruits list`.

{% set a %}
```{heading=":fas-file: fruits.txt"}
apples
bananas
cherries
dragon fruits
elderberries
figs
```
{% endset %}
{% set b %}<small>%%[update file as...]%%</small> {% endset %}
{% set c %}
```{heading=":fas-file: fruits.txt"}
apples, apricots
bananas
blueberries
cherries
dragon fruits
figs
```
{% endset %}
{{ show_transformation_columns(a, b, c) }}

{% set cli %} <!-- start: git tabs -->
After creating the new commit, the output of `git log --oneline --decorate` should be of the form:
```
e60deae (HEAD -> master) Update fruits list
f761ea6 (origin/master) Add colours.txt, shapes.txt
2bedace Add figs to fruits.txt
d5f91de Add fruits.txt
```
After pushing the new commit to the remote, the remote-tracking branch ref should move to the new commit:
```
e60deae (HEAD -> master, origin/master) Update fruits list
f761ea6 Add colours.txt, shapes.txt
2bedace Add figs to fruits.txt
d5f91de Add fruits.txt
```
{% endset %}
{% set sourcetree %}

After creating the new commit, the branch ref (`master`) will move to the new commit, but the remote-tracking branch ref (`origin/master`) will remain at the previous commit. Sourcetree will also indicate that your local branch is _1 commit ahead_ (i.e., has one more commit than) the remote-tracking branch.

<pic src="images/sourcetreeBeforePushing.png" width="500" />

After pushing the new commit to the remote, the remote-tracking branch ref should move to the new commit:

<pic src="images/sourcetreeAfterPushing.png" width="500" />
{% endset %}
{{ show_git_tabs_from_text(cli, sourcetree) }} <!-- end: git tabs -->

{% endcall %}

</div>
<div id="extras">
</div>
