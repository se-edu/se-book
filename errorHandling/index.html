<!DOCTYPE html>
<html>
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SEforSDL - Error Handling</title>
    <link rel="stylesheet" href="..\markbind\css\bootstrap.min.css">
    <link rel="stylesheet" href="..\markbind\css\bootstrap-vue.min.css">
    <link rel="stylesheet" href="..\markbind\css\font-awesome.min.css" >
    <link rel="stylesheet" href="..\markbind\css\bootstrap-glyphicons.min.css" >
    <link rel="stylesheet" href="..\markbind\css\github.min.css">
    <link rel="stylesheet" href="..\markbind\css\markbind.css">
    
    
    <link rel="icon" href="/se-book/favicon.ico">
</head>
<body>
<div id="app">
    <div id="content-wrapper">
  <div>
    <navbar placement="top" type="inverse">
      <a slot="brand" href="/" title="Home" class="navbar-brand">Software Engineering for Self-Directed Learners</a>
      <li slot="right">
        <searchbar :data="searchData" placeholder="Search" :on-hit="searchCallback" menu-align-right=""></searchbar>
      </li>
    </navbar>
  </div>
  <div>
    <link rel="stylesheet" href="/se-book/css/textbook.css">
    <div class="website-content" id="all">
      <p><span class="dimmed"><strong><span></span></strong>
        </span>
      </p>
      <div id="title">
        <div>
          <h1 id="error-handling">Error Handling</h1>
        </div>
      </div>
      <div id="main">
        <div>
          <div>
            <panel type="seamless" expanded="">
              <span slot="header" class="card-title"><div>
<h2 id="introduction">Introduction</h2></div></span>
              <div>
                <div>
                  <panel type="seamless" expanded="">
                    <span slot="header" class="card-title"><div>
<h4 id="what">What</h4></div></span>
                    <div class="indented">
                      <p><span class="badge badge-light"><span><span class="dimmed"><span><span class="fas fa-trophy"></span> Can explain error handling</span>
                        </span>
                        </span>
                        </span>
                        <p></p>
                      </p>
                      <p></p>
                      <div>
                        <blockquote>
                          <p>Well-written applications include error-handling code that allows them to recover gracefully from unexpected errors. When an error occurs, the application may need to request user intervention, or it may be able to recover on
                            its own. In extreme cases, the application may log the user off or shut down the system. --<sub><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms679320(v=vs.85).aspx">(source)</a></sub></p>
                        </blockquote>
                      </div>
                      <div></div>
                    </div>
                  </panel>
                </div>
              </div>
            </panel>
          </div>
          <div>
            <panel type="seamless" expanded="">
              <span slot="header" class="card-title"><div>
<h2 id="exceptions">Exceptions</h2></div></span>
              <div>
                <div>
                  <panel type="seamless" expanded="">
                    <span slot="header" class="card-title"><div>
<h4 id="what-2">What</h4></div></span>
                    <div class="indented">
                      <p><span class="badge badge-light"><span><span class="dimmed"><span><span class="fas fa-trophy"></span> Can explain exceptions</span>
                        </span>
                        </span>
                        </span>
                        <p></p>
                      </p>
                      <p></p>
                      <div>
                        <p><strong>Exceptions are used to deal with <em>'unusual' but not entirely unexpected</em> situations</strong> that the program might encounter at run time.</p>
                        <tip-box type="definition">
                          <div>
                            <p><strong>Exception</strong>:</p>
                            <blockquote>
                              <p>The term <em>exception</em> is shorthand for the phrase &quot;exceptional event.&quot; An <em>exception</em> is an event, which occurs during the execution of a program, that disrupts the normal flow of the program's instructions.
                                ‚Äì- Java Tutorial (Oracle Inc.)</p>
                            </blockquote>
                          </div>
                        </tip-box>
                        <tip-box>
                          <p><span class="fas fa-cube"></span> Examples:</p>
                          <ul>
                            <li>A network connection encounters a timeout due to a slow server.</li>
                            <li>The code tries to read a file from the hard disk but the file is corrupted and cannot be read.</li>
                          </ul>
                        </tip-box>
                      </div>
                      <div></div>
                    </div>
                  </panel>
                </div>
                <div>
                  <panel type="seamless" expanded="">
                    <span slot="header" class="card-title"><div>
<h4 id="how">How</h4></div></span>
                    <div class="indented">
                      <p><span class="badge badge-light"><span><span class="dimmed"><span><span class="fas fa-trophy"></span> Can explain how exception handling is done typically</span>
                        </span>
                        </span>
                        </span>
                        <p></p>
                      </p>
                      <p></p>
                      <div>
                        <p><strong>Most languages allow a method/function to encapsulate the unusual situation in an Exception object and 'throw'/'raise' that object so that another piece of code can 'catch' it and deal with it.</strong> This is especially
                          useful when code segment that encountered the unusual situation does not know how to deal with it.</p>
                        <p><strong>Exception objects can propagate up the function call hierarchy until it is dealt with.</strong> Usually, an exception thrown by a function is caught by the caller function. If the called function does not know how to deal
                          with the exception it caught, it can throw/raise the Exception object to its own caller. If none of the callers is prepared to deal with the exception, the exceptions can propagate through the
                          <tooltip content="the hieararchy of function calls">function call stack</tooltip> until it is received by the main function and thrown to the runtime, thus halting the system.</p>
                        <p>Advantages of exception handling in this way:</p>
                        <ul>
                          <li>The ability to propagate error information through the call stack.</li>
                          <li>The separation of code that deals with 'unusual' situations from the code that does the 'usual' work.</li>
                        </ul>
                      </div>
                      <div>
                        <div>
                          <panel header="<span class='fas fa-dumbbell'></span> Exercises" expandable="">
                            <div>
                              <panel header="<span class='glyphicon glyphicon-question-sign' aria-hidden='true'></span><span class='glyphicon glyphicon-ok-sign' aria-hidden='true'></span> Benefit of exceptions">
                                <question>
                                  <p>Which are benefits of exceptions?</p>
                                  <ul class="task-list">
                                    <li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox"> a. Exceptions allow us to separate normal code from error handling code.</li>
                                    <li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox"> b. Exceptions can prevent problems that happen in the environment.</li>
                                    <li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox"> c. Exceptions allow us to handle in one location an error raised in another location.</li>
                                  </ul>
                                  <div slot="answer">
                                    <p>(a) (c)</p>
                                    <p>Explanation: Exceptions cannot <em>prevent</em> problems in the environment. They can only be used to handle and recover from such problems.</p>
                                  </div>
                                </question>
                              </panel>
                            </div>
                          </panel>
                        </div>
                      </div>
                    </div>
                  </panel>
                </div>
                <div>
                  <panel type="seamless" expanded="">
                    <span slot="header" class="card-title"><div>
<h4 id="when">When</h4></div></span>
                    <div class="indented">
                      <p><span class="badge badge-light"><span><span class="dimmed"><span><span class="fas fa-trophy"></span> Can avoid using exceptions to control normal workflow</span>
                        </span>
                        </span>
                        </span>
                        <p></p>
                      </p>
                      <p></p>
                      <div>
                        <p>In general, use exceptions only for 'unusual' conditions. Use normal <code>return</code> statements to pass control to the caller for conditions that are 'normal'.</p>
                      </div>
                      <div></div>
                    </div>
                  </panel>
                </div>
              </div>
            </panel>
          </div>
          <div>
            <panel type="seamless" expanded="">
              <span slot="header" class="card-title"><div>
<h2 id="assertions">Assertions</h2></div></span>
              <div>
                <div>
                  <panel type="seamless" expanded="">
                    <span slot="header" class="card-title"><div>
<h4 id="what-3">What</h4></div></span>
                    <div class="indented">
                      <p><span class="badge badge-light"><span><span class="dimmed"><span><span class="fas fa-trophy"></span> Can explain assertions</span>
                        </span>
                        </span>
                        </span>
                        <p></p>
                      </p>
                      <p></p>
                      <div>
                        <p><strong><em>Assertions</em> are used to define assumptions about the program state so that the runtime can verify them.</strong> An assertion failure indicates a possible bug in the code <span class="dimmed">because the code has resulted in a program state that violates an assumption about how the code <em>should</em> behave</span>.</p>
                        <tip-box>
                          <p><span class="fas fa-cube"></span> An assertion can be used to express something like <em>when the execution comes to this point, the variable <code>v</code> cannot be null</em>.</p>
                        </tip-box>
                        <p><strong>If the runtime detects an <em>assertion failure</em>, it typically take some drastic action</strong> such as terminating the execution with an error message. This is because an assertion failure indicates a possible bug
                          and the sooner the execution stops, the safer it is.</p>
                        <tip-box>
                          <p><span class="fas fa-cube"></span> In the Java code below, suppose we set an assertion that <code>timeout</code> returned by <code>Config.getTimeout()</code> is greater than <code>0</code>. Now, if the <code>Config.getTimeout()</code>                            returned <code>-1</code> in a specific execution of this line, the runtime can detect it as a <em>assertion failure</em> -- i.e. an assumption about the expected behavior of the code turned out to be wrong which could potentially
                            be the result of a bug -- and take some drastic action such as terminating the execution.</p>
                          <pre><code class="hljs java"><span class="hljs-keyword">int</span> timeout = Config.getTimeout(); 
</code></pre>
                        </tip-box>
                      </div>
                      <div></div>
                    </div>
                  </panel>
                </div>
                <div>
                  <panel type="seamless" expanded="">
                    <span slot="header" class="card-title"><div>
<h4 id="how-2">How</h4></div></span>
                    <div class="indented">
                      <p><span class="badge badge-light"><span><span class="dimmed"><span><span class="fas fa-trophy"></span> Can use assertions</span>
                        </span>
                        </span>
                        </span>
                        <p></p>
                      </p>
                      <p></p>
                      <div>
                        <p>Use the <code>assert</code> keyword to define assertions.</p>
                        <tip-box>
                          <p><span class="fas fa-cube"></span> This assertion will fail with the message <code>x should be 0</code> if <code>x</code> is not 0 at this point.</p>
                          <pre><code class="hljs java">x = getX();
<span class="hljs-keyword">assert</span> x == <span class="hljs-number">0</span> : <span class="hljs-string">"x should be 0"</span>;
...
</code></pre>
                        </tip-box>
                        <p><strong>Assertions can be disabled without modifying the code.</strong></p>
                        <tip-box>
                          <p><span class="fas fa-cube"></span> <code>java -enableassertions HelloWorld</code> (or <code>java -ea HelloWorld</code>) will run <code>HelloWorld</code> with assertions enabled while <code>java -disableassertions HelloWorld</code>                            will run it without verifying assertions.</p>
                        </tip-box>
                        <tip-box type="important">
                          <p><strong>Java disables assertions by default.</strong> This could create a situation where you think all assertions are being verified as <code>true</code> while in fact they are not being verified at all. Therefore, remember
                            to enable assertions when you run the program if you want them to be in effect.</p>
                        </tip-box>
                        <tip-box>
                          <p>üí° Enable assertions in Intellij (<a href="https://stackoverflow.com/questions/18168257/where-to-add-compiler-options-like-ea-in-intellij-idea">how?</a>) and get an assertion to fail temporarily (e.g. insert an <code>assert false</code>                            into the code temporarily) to confirm assertions are being verified.</p>
                        </tip-box>
                        <tip-box type="info">
                          <p><strong>Java <code>assert</code> vs JUnit assertions</strong>: They are similar in purpose but JUnit assertions are more powerful and customized for testing. In addition, JUnit assertions are not disabled by default. We recommend
                            you use JUnit assertions in test code and Java <code>assert</code> in functional code.</p>
                        </tip-box>
                      </div>
                      <div>
                        <div>
                          <panel header="<span class='fas fa-paperclip'></span> Resources" expanded="">
                            <p><strong>Tutorials</strong>:</p>
                            <ul>
                              <li><a href="https://www.javatpoint.com/assertion-in-java"><strong>Java Assertions</strong></a> -- a simple tutorial from <em><a href="http://javatpoint.com">javatpoint.com</a></em></li>
                              <li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/language/assert.html"><strong>Programming with Assertions</strong> (first half)</a> -- a more detailed tutorial from <em>Oracle</em></li>
                            </ul>
                            <p><strong>Best practices</strong>:</p>
                            <ul>
                              <li><a href="http://docs.oracle.com/javase/8/docs/technotes/guides/language/assert.html#usage"><strong>Programming with Assertions</strong> (second half)</a> -- <em>from Oracle</em> (also listed above as a tutorial) contains
                                some best practices towards the end of the article.</li>
                            </ul>
                          </panel>
                        </div>
                      </div>
                    </div>
                  </panel>
                </div>
                <div>
                  <panel type="seamless" expanded="">
                    <span slot="header" class="card-title"><div>
<h4 id="when-2">When</h4></div></span>
                    <div class="indented">
                      <p><span class="badge badge-light"><span><span class="dimmed"><span><span class="fas fa-trophy"></span> Can use assertions optimally</span>
                        </span>
                        </span>
                        </span>
                        <p></p>
                      </p>
                      <p></p>
                      <div>
                        <p><strong>It is recommended that assertions be used liberally in the code.</strong> Their impact on performance is considered low and worth the additional safety they provide.</p>
                        <p><strong>Do not use assertions to do <em>work</em></strong> because assertions can be disabled. If not, your program will stop working when assertions are not enabled.</p>
                        <tip-box>
                          <p><span class="fas fa-cube"></span> The code below will not invoke the <code>writeFile()</code> method when assertions are disabled. <span class="dimmed">¬†If that method is performing some work that is necessary for your program, your program will not work correctly when assertions are disabled.</span></p>
                          <pre><code class="hljs java">...
<span class="hljs-function"><span class="hljs-keyword">assert</span> <span class="hljs-title">writeFile</span><span class="hljs-params">()</span> : "File writing is supposed to return <span class="hljs-keyword">true</span>"</span>;
</code></pre>
                        </tip-box>
                        <p><strong>Assertions are suitable for verifying assumptions about <em>Internal Invariants</em>, <em>Control-Flow Invariants</em>,
<em>Preconditions</em>, <em>Postconditions</em>, and <em>Class Invariants</em>.</strong> Refer to [<a href="http://docs.oracle.com/javase/8/docs/technotes/guides/language/assert.html#usage">Programming with Assertions (second half)</a>] to learn more.</p>
                        <p><strong>Exceptions and assertions are two complementary ways of handling errors in software but they serve different purposes.</strong> Therefore, both assertions and exceptions should be used in code.</p>
                        <ul>
                          <li>The raising of an exception indicates an unusual condition created by the user <span class="dimmed">¬†(e.g.  user inputs an unacceptable input)</span> or the environment <span class="dimmed">¬†(e.g., a file needed for the program is missing)</span>.</li>
                          <li>An assertion failure indicates the programmer made a mistake in the code <span class="dimmed">¬†(e.g., a null value is returned from a method that is not supposed to return null under any circumstances)</span>.</li>
                        </ul>
                      </div>
                      <div>
                        <div>
                          <panel header="<span class='fas fa-dumbbell'></span> Exercises" expandable="">
                            <div>
                              <panel header="<span class='glyphicon glyphicon-question-sign' aria-hidden='true'></span><span class='glyphicon glyphicon-ok-sign' aria-hidden='true'></span> Assertions failure in Calculator">
                                <question>
                                  <p>A Calculator program crashes with an ‚Äòassertion failure‚Äô message when you try to find the square root of a negative number.</p>
                                  <ul radio-group="f7dad" class="radio-list">
                                    <li class="radio-list-item"><label><input class="radio-list-input" name="f7dad" type="radio"> a. This is a correct use of assertions.</label></li>
                                    <li class="radio-list-item"><label><input class="radio-list-input" name="f7dad" type="radio"> b. The application should have terminated with an exception instead.</label></li>
                                    <li class="radio-list-item"><label><input class="radio-list-input" name="f7dad" type="radio"> c. The program has a bug.</label></li>
                                    <li class="radio-list-item"><label><input class="radio-list-input" name="f7dad" type="radio"> d. All statements above are incorrect.</label></li>
                                  </ul>
                                  <div slot="answer">
                                    <p>(c)</p>
                                    <p>Explanation: An assertion failure indicates a bug in the code. (b) is not acceptable because of the word &quot;terminated&quot;. The application should not fail at all for this input. But it could have used an exception
                                      to handle the situation internally.</p>
                                  </div>
                                </question>
                              </panel>
                            </div>
                            <div>
                              <panel header="<span class='glyphicon glyphicon-question-sign' aria-hidden='true'></span><span class='glyphicon glyphicon-ok-sign' aria-hidden='true'></span> Statement about exceptions and assertions">
                                <question>
                                  <p>Which statements are correct?</p>
                                  <ul class="task-list">
                                    <li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox"> a. Use assertions to indicate the programmer messed up; Use exceptions to indicate the user or the environment messed up.</li>
                                    <li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox"> b. Use exceptions to indicate the programmer messed up; Use assertions to indicate the user or the environment messed up.</li>
                                  </ul>
                                  <div slot="answer">
                                    <p>(a)</p>
                                  </div>
                                </question>
                              </panel>
                            </div>
                          </panel>
                        </div>
                      </div>
                    </div>
                  </panel>
                </div>
              </div>
            </panel>
          </div>
          <div>
            <panel type="seamless" expanded="">
              <span slot="header" class="card-title"><div>
<h2 id="logging">Logging</h2></div></span>
              <div>
                <div>
                  <panel type="seamless" expanded="">
                    <span slot="header" class="card-title"><div>
<h4 id="what-4">What</h4></div></span>
                    <div class="indented">
                      <p><span class="badge badge-light"><span><span class="dimmed"><span><span class="fas fa-trophy"></span> Can explain logging</span>
                        </span>
                        </span>
                        </span>
                        <p></p>
                      </p>
                      <p></p>
                      <div>
                        <p><strong><em>Logging</em> is the deliberate recording of certain information during a program execution for future reference.</strong> Logs are typically written to a log file but it is also possible to log information in other
                          ways <span class="dimmed">¬†e.g. into a database or a remote server</span>.</p>
                        <p><strong><em>Logging</em> can be useful for troubleshooting problems</strong>. A good logging system records some system information regularly. When bad things happen to a system <span class="dimmed">¬†e.g. an unanticipated failure</span>,
                          their associated log files may provide indications of what went wrong and action can then be taken to prevent it from happening again.</p>
                        <div v-closeable="" alt="blackbox photo">
                          <tip-box>
                            <p>üí° <strong>A log file is like the <tooltip content="flight data recorder">black box</tooltip> of an airplane</strong>; they don't prevent problems but they can be helpful in understanding what went wrong after the fact.</p>
                            <div class="non-printable">
                              <p><img src="https://upload.wikimedia.org/wikipedia/commons/5/5b/Flight_data_recorder_displayed_at_HAL_Museum_7893.JPG" width="250"><br>
                                <sub>source:<a href="https://upload.wikimedia.org/wikipedia/commons/5/5b/Flight_data_recorder_displayed_at_HAL_Museum_7893.JPG">https://commons.wikimedia.org</a></sub></p>
                            </div>
                          </tip-box>
                        </div>
                      </div>
                      <div>
                        <div>
                          <panel header="<span class='fas fa-dumbbell'></span> Exercises" expandable="">
                            <div>
                              <panel header="<span class='glyphicon glyphicon-question-sign' aria-hidden='true'></span><span class='glyphicon glyphicon-ok-sign' aria-hidden='true'></span> Logging vs blackbox">
                                <question>
                                  <p>Why is logging like having the 'black box' in an airplane?</p>
                                  <ul radio-group="6f5b0" class="radio-list">
                                    <li class="radio-list-item"><label><input class="radio-list-input" name="6f5b0" type="radio"> a. Because they can be used to find more info about how the system behaved before/during an ‚Äòincident‚Äô.</label></li>
                                    <li class="radio-list-item"><label><input class="radio-list-input" name="6f5b0" type="radio"> b. Because they are hidden from the view of normal users.</label></li>
                                    <li class="radio-list-item"><label><input class="radio-list-input" name="6f5b0" type="radio"> c. Because they both can be in hardcopy form or digital form.</label></li>
                                    <li class="radio-list-item"><label><input class="radio-list-input" name="6f5b0" type="radio"> d. Because they are hard to open by normal users.</label></li>
                                  </ul>
                                  <div slot="answer">
                                    <p>(a)</p>
                                  </div>
                                </question>
                              </panel>
                            </div>
                          </panel>
                        </div>
                      </div>
                    </div>
                  </panel>
                </div>
                <div>
                  <panel type="seamless" expanded="">
                    <span slot="header" class="card-title"><div>
<h4 id="how-3">How</h4></div></span>
                    <div class="indented">
                      <p><span class="badge badge-light"><span><span class="dimmed"><span><span class="fas fa-trophy"></span> Can use logging</span>
                        </span>
                        </span>
                        </span>
                        <p></p>
                      </p>
                      <p></p>
                      <div>
                        <p><strong>Most programming environments come with logging systems that allow sophisticated forms of logging.</strong> They have features such as the ability to enable and disable logging easily or to change the logging
                          <tooltip content="how much information to record">intensity</tooltip>.</p>
                        <tip-box>
                          <p><span class="fas fa-cube"></span> This sample Java code uses Java‚Äôs default logging mechanism.</p>
                          <p>First, import the relevant Java package:</p>
                          <pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.logging.*;
</code></pre>
                          <p>Next, create a <code>Logger</code>:</p>
                          <pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Logger logger = Logger.getLogger(<span class="hljs-string">"Foo"</span>);
</code></pre>
                          <p>Now, you can use the <code>Logger</code> object to log information. Note the use of
                            <popover content="`INFO`, `WARNING` etc.">logging level</popover> for each message. When running the code, the logging level can be set to <code>WARNING</code> so that log messages specified as <code>INFO</code> level (which is a lower level than <code>WARNING</code>)
                            will not be written to the log file at all.</p>
                          <pre><code class="hljs java"><span class="hljs-comment">// log a message at INFO level</span>
logger.log(Level.INFO, <span class="hljs-string">"going to start processing"</span>);
<span class="hljs-comment">//...</span>
processInput();
<span class="hljs-keyword">if</span>(error){
    <span class="hljs-comment">//log a message at WARNING level</span>
    logger.log(Level.WARNING, <span class="hljs-string">"processing error"</span>, ex);
}
<span class="hljs-comment">//...</span>
logger.log(Level.INFO, <span class="hljs-string">"end of processing"</span>);
</code></pre>
                        </tip-box>
                      </div>
                      <div>
                        <div>
                          <panel header="<span class='fas fa-paperclip'></span> Resources" expanded="">
                            <p><strong>Tutorials</strong>:</p>
                            <ul>
                              <li><a href="http://www.vogella.com/tutorials/Logging/article.html"><strong>Java Logging API - Tutorial</strong></a> -- A tutorial by <em>Lars Vogella</em></li>
                              <li><a href="http://tutorials.jenkov.com/java-logging/index.html"><strong>Java Logging Tutorial</strong></a> -- An alternative tutorial by <em>Jakob Jenkov</em></li>
                            </ul>
                            <div v-closeable="" alt="video:logging">
                              <ul>
                                <li>A video tutorial by <em>SimplyCoded</em>:<br></li>
                              </ul>
                              <div class="block-embed block-embed-service-youtube"><iframe type="text/html" src="//www.youtube.com/embed/W0_Man88Z3Q" frameborder="0" width="640" height="390" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div>
                            </div>
                            <p><strong>Best Practices</strong>:</p>
                            <ul>
                              <li><a href="https://www.javacodegeeks.com/2011/01/10-tips-proper-application-logging.html"><strong>10 Tips for Proper Application Logging</strong></a> -- by <em>Tomasz Nurkiewicz</em></li>
                              <li><a href="http://commons.apache.org/proper/commons-logging/guide.html#Message_PrioritiesLevels"><strong>What each logging level means</strong></a> -- conventions recommended by <em>Apache Project</em></li>
                            </ul>
                          </panel>
                        </div>
                      </div>
                    </div>
                  </panel>
                </div>
              </div>
            </panel>
          </div>
          <div>
            <panel type="seamless" expanded="">
              <span slot="header" class="card-title"><div>
<h2 id="defensive-programming">Defensive Programming</h2></div></span>
              <div>
                <div>
                  <panel type="seamless" expanded="">
                    <span slot="header" class="card-title"><div>
<h4 id="what-5">What</h4></div></span>
                    <div class="indented">
                      <p><span class="badge badge-light"><span><span class="dimmed"><span><span class="fas fa-trophy"></span> Can explain defensive programming</span>
                        </span>
                        </span>
                        </span>
                        <p></p>
                      </p>
                      <p></p>
                      <div>
                        <p><strong>A defensive programmer codes under the assumption &quot;if we leave room for things to go wrong, they <em>will</em> go wrong&quot;.</strong> Therefore, a defensive programmer proactively tries to eliminate any room for
                          things to go wrong.</p>
                        <tip-box>
                          <p><span class="fas fa-cube"></span> Consider a <code>MainApp#getConfig()</code> a method that returns a <code>Config</code> object containing configuration data. A typical implementation is given below:</p>
                          <pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainApp</span></span>{
    Config config;
    
    <span class="hljs-comment">/** Returns the config object */</span>
    <span class="hljs-function">Config <span class="hljs-title">getConfig</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">return</span> config;
    }
}
</code></pre>
                          <p>If the returned Config object is not meant to be modified, a defensive programmer might use a more <em>defensive</em> implementation given below. <span class="dimmed">¬† This is more defensive because even if the returned <code>Config</code> object is modified (although it is not meant to be) it will not affect the <code>config</code> object inside the <code>MainApp</code> object.</span></p>
                          <pre><code class="hljs java">    <span class="hljs-comment">/** Returns a copy of the config object */</span>
    <span class="hljs-function">Config <span class="hljs-title">getConfig</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">return</span> config.copy(); <span class="hljs-comment">//return a defensive copy</span>
    }
</code></pre>
                        </tip-box>
                      </div>
                      <div></div>
                    </div>
                  </panel>
                </div>
                <div>
                  <panel type="seamless" expanded="">
                    <span slot="header" class="card-title"><div>
<h4 id="enforcing-compulsory-associations">Enforcing Compulsory Associations</h4></div></span>
                    <div class="indented">
                      <p><span class="badge badge-light"><span><span class="dimmed"><span><span class="fas fa-trophy"></span> Can use defensive coding to enforce compulsory associations</span>
                        </span>
                        </span>
                        </span>
                        <p></p>
                      </p>
                      <p></p>
                      <div>
                        <p>Consider two classes, <code>Account</code> and <code>Guarantor</code>, with an association as shown in the following diagram:</p>
                        <tip-box>
                          <p>Example:</p>
                          <img src="/se-book/errorHandling/defensiveProgramming/compulsoryAssociations/images/accountGuarantor.png" height="50">
                          <p></p>
                          <p>Here, the association is compulsory i.e. an <code>Account</code> object should always be linked to a <code>Guarantor</code>. One way to implement this is to simply use a reference variable, like this:</p>
                          <pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Account</span> </span>{
    Guarantor guarantor;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setGuarantor</span><span class="hljs-params">(Guarantor g)</span> </span>{
        guarantor = g;
    }
}
</code></pre>
                          <p>However, what if someone else used the <code>Account</code> class like this?</p>
                          <pre><code class="hljs java">Account a = <span class="hljs-keyword">new</span> Account();
a.setGuarantor(<span class="hljs-keyword">null</span>);
</code></pre>
                          <p>This results in an <code>Account</code> without a <code>Guarantor</code>! In a real banking system, this could have serious consequences! The code here did not try to prevent such a thing from happening. We can make the code
                            more defensive by proactively enforcing the multiplicity constraint, like this:</p>
                          <pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Account</span> </span>{
    <span class="hljs-keyword">private</span> Guarantor guarantor;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Account</span><span class="hljs-params">(Guarantor g)</span></span>{
        <span class="hljs-keyword">if</span> (g == <span class="hljs-keyword">null</span>) {
            stopSystemWithMessage(<span class="hljs-string">"multiplicity violated. Null Guarantor"</span>);
        }
        guarantor = g;
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setGuarantor</span> <span class="hljs-params">(Guarantor g)</span></span>{
        <span class="hljs-keyword">if</span> (g == <span class="hljs-keyword">null</span>) {
            stopSystemWithMessage(<span class="hljs-string">"multiplicity violated. Null Guarantor"</span>);
        }
        guarantor = g;
    }
    ‚Ä¶
}
</code></pre>
                        </tip-box>
                      </div>
                      <div>
                        <div>
                          <panel header="<span class='fas fa-dumbbell'></span> Exercises" expandable="">
                            <div>
                              <panel header="<span class='glyphicon glyphicon-question-sign' aria-hidden='true'></span><span class='glyphicon glyphicon-ok-sign' aria-hidden='true'></span> Write a `Manager#addAccount()`">
                                <question has-input="true">
                                  <p>For the <code>Manager</code> class shown below, write an <code>addAccount()</code> method that</p>
                                  <ul>
                                    <li>restricts the maximum number of Accounts to 8</li>
                                    <li>avoids adding duplicate Accounts</li>
                                  </ul>
                                  <img src="/se-book/errorHandling/defensiveProgramming/compulsoryAssociations/images/managerAccount.jpg" height="55">
                                  <p></p>
                                  <div slot="answer">
                                    <pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.*;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Manager</span> </span>{
    <span class="hljs-keyword">private</span> ArrayList&lt; Account &gt; theAccounts ;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addAccount</span><span class="hljs-params">(Account acc)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        <span class="hljs-keyword">if</span> (theAccounts.size( ) == <span class="hljs-number">8</span>){
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception (<span class="hljs-string">"adding more than 8 accounts"</span>);
        }
        
        <span class="hljs-keyword">if</span> (!theAccounts.contains(acc)) {
            theAccounts.add(acc);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeAccount</span><span class="hljs-params">(Account acc)</span> </span>{
        theAccounts.remove(acc);
    }
}
</code></pre>
                                  </div>
                                </question>
                              </panel>
                            </div>
                            <div>
                              <panel header="<span class='glyphicon glyphicon-question-sign' aria-hidden='true'></span><span class='glyphicon glyphicon-ok-sign' aria-hidden='true'></span> Implement `Marriage`">
                                <question has-input="true">
                                  <p>Implement the classes defensively with appropriate references and operations to establish the association among the classes. Follow the defensive coding approach. Let the <code>Marriage</code> class handle setting/removal
                                    of reference.</p>
                                  <img src="/se-book/errorHandling/defensiveProgramming/compulsoryAssociations/images/manMarriageWoman.jpg" height="55">
                                  <p></p>
                                  <div slot="answer">
                                    <pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Marriage</span> </span>{
    <span class="hljs-keyword">private</span> Man husband = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">private</span> Woman wife = <span class="hljs-keyword">null</span>;

    <span class="hljs-comment">// extra information like date etc can be added</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Marriage</span><span class="hljs-params">(Man m, Woman w)</span> <span class="hljs-keyword">throws</span> Exception </span>{
        <span class="hljs-keyword">if</span> (m == <span class="hljs-keyword">null</span> || w == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"no man/woman"</span>);
        }
        <span class="hljs-keyword">if</span> (m.isMarried() || w.isMarried()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"already married"</span>);
        }
        husband = m;
        m.enterMarriage(<span class="hljs-keyword">this</span>);
        wife = w;
        w.enterMarriage(<span class="hljs-keyword">this</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Man <span class="hljs-title">getHusband</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
        <span class="hljs-keyword">if</span>(husband == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"error state"</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> husband;
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Woman <span class="hljs-title">getWife</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
        <span class="hljs-keyword">if</span>(wife == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"error state"</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> wife;
        }
    }

    <span class="hljs-comment">// removal of both ends of 'Marriage'</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">divorce</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
        <span class="hljs-keyword">if</span> (husband==<span class="hljs-keyword">null</span> || wife==<span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"no marriage"</span>);
        }
        husband.removeFromMarriage(<span class="hljs-keyword">this</span>);
        husband = <span class="hljs-keyword">null</span>;
        wife.removeFromMarriage(<span class="hljs-keyword">this</span>);
        wife = <span class="hljs-keyword">null</span>;
    }
} 
</code></pre>
                                  </div>
                                </question>
                              </panel>
                            </div>
                            <div>
                              <panel header="<span class='glyphicon glyphicon-question-sign' aria-hidden='true'></span><span class='glyphicon glyphicon-ok-sign' aria-hidden='true'></span> Immutable `Account` class">
                                <question has-input="true">
                                  <p>Give a suitable defensive implementation to the <code>Account</code> class in the following class diagram. Note that ‚Äú{immutable}‚Äù means once the association is formed, it cannot be changed.</p>
                                  <img src="/se-book/errorHandling/defensiveProgramming/compulsoryAssociations/images/accountGuarantorImmutable.png" height="80">
                                  <p></p>
                                  <div slot="answer">
                                    <pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Account</span> </span>{
    <span class="hljs-keyword">private</span> Guarantor myGuarantor; <span class="hljs-comment">// should not be public</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Account</span><span class="hljs-params">(Guarantor g)</span></span>{
        <span class="hljs-keyword">if</span> (g==<span class="hljs-keyword">null</span>) {
            haltWithErrorMessage(‚ÄúAccount must have a guarantor‚Äù);
        }
        myGuarantor = g;
    }
    <span class="hljs-comment">// there should not be a setGuarantor method</span>
}
</code></pre>
                                  </div>
                                </question>
                              </panel>
                            </div>
                            <div>
                              <panel header="<span class='glyphicon glyphicon-question-sign' aria-hidden='true'></span><span class='glyphicon glyphicon-ok-sign' aria-hidden='true'></span> Is this defensive?">
                                <question>
                                  <img src="/se-book/errorHandling/defensiveProgramming/compulsoryAssociations/images/countryCity.png" height="45">
                                  <p></p>
                                  <pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">City</span></span>{
    Country country;
    
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setCountry</span><span class="hljs-params">(Country country)</span></span>{
        <span class="hljs-keyword">this</span>.country = country;
    }
}
</code></pre>
                                  <p>This is a defensive implementation of the association.</p>
                                  <ul radio-group="ac03f" class="radio-list">
                                    <li class="radio-list-item"><label><input class="radio-list-input" name="ac03f" type="radio"> True</label></li>
                                    <li class="radio-list-item"><label><input class="radio-list-input" name="ac03f" type="radio"> False</label></li>
                                  </ul>
                                  <div slot="answer">
                                    <p>False</p>
                                    <p>Explanation: While the design requires a City to be connected to exactly one Country, the code allows it to be connected to zero Country objects (by passing null to the setCountry() method).</p>
                                  </div>
                                </question>
                              </panel>
                            </div>
                          </panel>
                        </div>
                      </div>
                    </div>
                  </panel>
                </div>
                <div>
                  <panel type="seamless" expanded="">
                    <span slot="header" class="card-title"><div>
<h4 id="enforcing-1-to-1-associations">Enforcing 1-to-1 Associations</h4></div></span>
                    <div class="indented">
                      <p><span class="badge badge-light"><span><span class="dimmed"><span><span class="fas fa-trophy"></span> Can use defensive coding to enforce 1-to-1 associations</span>
                        </span>
                        </span>
                        </span>
                        <p></p>
                      </p>
                      <p></p>
                      <div>
                        <p>Consider the association given below. A defensive implementation requires to ensure a <code>MinedCell</code> cannot exist without a <code>Mine</code> and vice versa which requires simultaneous object creation. However, Java can
                          only create one object at a time. Given below are two alternatives implementations, both of which violate the multiplicity for a short period of time.</p>
                        <img src="/se-book/errorHandling/defensiveProgramming/1to1Associations/images/minedCell.png" height="50">
                        <p></p>
                        <p>Option 1:</p>
                        <pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MinedCell</span> </span>{
    <span class="hljs-keyword">private</span> Mine mine;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MinedCell</span><span class="hljs-params">(Mine m)</span></span>{
        <span class="hljs-keyword">if</span> (m == <span class="hljs-keyword">null</span>) {
            showError();
        }
        mine = m;
    }
    ‚Ä¶
}
</code></pre>
                        <p>Option 1 forces us to keep a <code>Mine</code> without a <code>MinedCell</code> (until the <code>MinedCell</code> is created).</p>
                        <p>Option 2:</p>
                        <pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MinedCell</span> </span>{
    <span class="hljs-keyword">private</span> Mine mine;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MinedCell</span><span class="hljs-params">()</span></span>{
        mine = <span class="hljs-keyword">new</span> Mine();
    }
    ‚Ä¶
}
</code></pre>
                        <p>Option 2 is more defensive because the <code>Mine</code> is immediately linked to a <code>MinedCell</code>.</p>
                      </div>
                      <div></div>
                    </div>
                  </panel>
                </div>
                <div>
                  <panel type="seamless" expanded="">
                    <span slot="header" class="card-title"><div>
<h4 id="enforcing-referential-integrity">Enforcing Referential Integrity</h4></div></span>
                    <div class="indented">
                      <p><span class="badge badge-light"><span><span class="dimmed"><span><span class="fas fa-trophy"></span> Can use defensive coding to enforce referential integrity of bi-directional associations</span>
                        </span>
                        </span>
                        </span>
                        <p></p>
                      </p>
                      <p></p>
                      <div>
                        <p>A bidirectional association in the design (shown in (a)) is usually emulated at code level using two variables (as shown in (b)).</p>
                        <img src="/se-book/errorHandling/defensiveProgramming/referentialIntegrity/images/manWoman.png" height="140">
                        <p></p>
                        <pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Man</span> </span>{
    Woman girlfriend;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setGirlfriend</span><span class="hljs-params">(Woman w)</span> </span>{
        girlfriend = w;
    }
    ‚Ä¶
}
</code></pre>
                        <pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Woman</span> </span>{
    Man boyfriend;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setBoyfriend</span><span class="hljs-params">(Man m)</span> </span>{
        boyfriend = m;
    }
}
</code></pre>
                        <p>The two classes are meant to be used as follows:</p>
                        <pre><code class="hljs java">Woman jean;
Man james;
‚Ä¶
james.setGirlfriend(jean);
jean.setBoyfriend(james);
</code></pre>
                        <p>Suppose the two classes were used this instead:</p>
                        <pre><code class="hljs java">Woman jean; Man james, yong;
‚Ä¶
james.setGirlfriend(jean);  
jean.setBoyfriend(yong);  
</code></pre>
                        <p>Now James' girlfriend is Jean, while Jean's boyfriend is not James. This situation results as the code was not defensive enough to stop this &quot;love triangle&quot;. In such a situation, we say that <em>the referential integrity has been violated</em>.
                          It simply means <em>there is an inconsistency in object references</em>.</p>
                        <img src="/se-book/errorHandling/defensiveProgramming/referentialIntegrity/images/woman.png" height="50">
                        <p></p>
                        <p>One way to prevent this situation is to implement the two classes as shown below. Note how the referential integrity is maintained.</p>
                        <pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Woman</span> </span>{
    <span class="hljs-keyword">private</span> Man boyfriend;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBoyfriend</span><span class="hljs-params">(Man m)</span> </span>{
        <span class="hljs-keyword">if</span>(boyfriend == m){
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (boyfriend != <span class="hljs-keyword">null</span>) {
            boyfriend.breakUp();
        }
        boyfriend = m;
        m.setGirlfriend(<span class="hljs-keyword">this</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">breakUp</span><span class="hljs-params">()</span> </span>{
        boyfriend = <span class="hljs-keyword">null</span>;
    }   
    ...
}
</code></pre>
                        <pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Man</span></span>{
    <span class="hljs-keyword">private</span> Woman girlfriend;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setGirlfriend</span><span class="hljs-params">(Woman w)</span> </span>{
        <span class="hljs-keyword">if</span>(girlfriend == w){
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (girlfriend != <span class="hljs-keyword">null</span>) {
            girlfriend.breakUp();
        }
        girlfriend = w;
        w.setBoyfriend(<span class="hljs-keyword">this</span>);
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">breakUp</span><span class="hljs-params">()</span> </span>{
        girlfriend = <span class="hljs-keyword">null</span>;
    }  
   ...
}
</code></pre>
                        <p>When the code <code>james.setGirlfriend(jean)</code> is executed, the code ensures that <code>james</code> break up with any current girlfriend before he accepts <code>jean</code> as the girlfriend. Furthermore, the code ensures
                          that <code>jean</code> breaks up with any existing boyfriends and accepts <code>james</code> as the boyfriend.</p>
                      </div>
                      <div>
                        <div>
                          <panel header="<span class='fas fa-dumbbell'></span> Exercises" expandable="">
                            <div>
                              <panel header="<span class='glyphicon glyphicon-question-sign' aria-hidden='true'></span><span class='glyphicon glyphicon-ok-sign' aria-hidden='true'></span> Implement `Player` and `Region`">
                                <question has-input="true">
                                  <p>Imagine that we now support the following feature in our Minesweeper game.</p>
                                  <tip-box>
                                    <p>Feature ID: multiplayer<br> Description: A minefield is divided into mine regions. Each region is assigned to a single player. Players can swap regions. To win the game, all regions must be cleared.</p>
                                  </tip-box>
                                  <p>Given below is an extract from our class diagram.</p>
                                  <img src="/se-book/errorHandling/defensiveProgramming/referentialIntegrity/images/playerRegion.png" height="100">
                                  <p></p>
                                  <p>Minimally, this can be implemented like this.</p>
                                  <pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Player</span></span>{
    Region region;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setRegion</span><span class="hljs-params">(Region r)</span> </span>{
        region = r;
    }
    <span class="hljs-function">Region <span class="hljs-title">getRegion</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> region;
    }
} 

<span class="hljs-comment">// Region class is similar</span>
</code></pre>
                                  <p>However, this is not very defensive. For example, a user of this class can pass a <code>null</code> to either of the methods, thus violating the multiplicity of the relationship.</p>
                                  <p>Implement the two classes using a more defensive approach. Take note of the bidirectional link which requires us to preserve referential integrity at all times.</p>
                                  <div slot="answer">
                                    <p>In this solution, we assume <code>Regions</code> can be created without <code>Players</code> (note that we cannot be 100% defensive all the time). The usage will be something like this:</p>
                                    <pre><code class="hljs java">Region r1 = <span class="hljs-keyword">new</span> Region();
Player p1 = <span class="hljs-keyword">new</span> Player(r1);
Region r2 = <span class="hljs-keyword">new</span> Region();
Player p2 = <span class="hljs-keyword">new</span> Player(r2);
p1.setRegion(r2);
r1.setPlayer(p2);
</code></pre>
                                    <p>Here are the two classes. Get methods are omitted as they are simple. Note how much extra effort we need to be defensive.</p>
                                    <pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Region</span> </span>{
    <span class="hljs-keyword">private</span> Player myPlayer;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Region</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// initialise region</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPlayer</span><span class="hljs-params">(Player newPlayer)</span> </span>{
        <span class="hljs-keyword">if</span> (newPlayer == <span class="hljs-keyword">null</span>) {
            stopSystemWithErrorMessage(<span class="hljs-string">"Multiplicity violation"</span>);
        }
        <span class="hljs-keyword">if</span> (myPlayer == newPlayer) {
            <span class="hljs-keyword">return</span>; <span class="hljs-comment">// same player</span>
        }
        <span class="hljs-keyword">if</span> (myPlayer != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// I already have a Player!</span>
            myPlayer.removeRegion(<span class="hljs-keyword">this</span>);
        }
        myPlayer = newPlayer;
        <span class="hljs-comment">// set the reverse link</span>
        myPlayer.setRegion(<span class="hljs-keyword">this</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removePlayer</span><span class="hljs-params">(Player disconnectingPlayer)</span> </span>{
        <span class="hljs-keyword">if</span> (myPlayer == disconnectingPlayer){
            myPlayer = <span class="hljs-keyword">null</span>;
        } <span class="hljs-keyword">else</span> {
            stopSystemWithErrorMessage(<span class="hljs-string">"Unknown Player trying to disconnect"</span>);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stopSystemWithErrorMessage</span><span class="hljs-params">(String msg)</span> </span>{
        ...
    }
}
</code></pre>
                                    <pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Player</span> </span>{
    <span class="hljs-keyword">private</span> Region myRegion;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Player</span><span class="hljs-params">(Region region)</span> </span>{
        setRegion(region);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setRegion</span><span class="hljs-params">(Region newRegion)</span> </span>{
        <span class="hljs-keyword">if</span> (newRegion == <span class="hljs-keyword">null</span>) {
            stopSystemWithErrorMessage(<span class="hljs-string">"Multiplicity violation"</span>);
        }
        <span class="hljs-keyword">if</span> (myRegion == newRegion) {
            <span class="hljs-keyword">return</span>; <span class="hljs-comment">// no change in Region!</span>
        }
        <span class="hljs-keyword">if</span> (myRegion != <span class="hljs-keyword">null</span>) {
            <span class="hljs-comment">// previous region exists</span>
            myRegion.removePlayer(<span class="hljs-keyword">this</span>);
        }
        myRegion = newRegion;
        
        <span class="hljs-comment">// set the reverse link</span>
        myRegion.setPlayer(<span class="hljs-keyword">this</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeRegion</span><span class="hljs-params">(Region disconnectingRegion)</span> </span>{
        <span class="hljs-keyword">if</span> (myRegion == disconnectingRegion) {
            myRegion = <span class="hljs-keyword">null</span>;
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stopSystemWithErrorMessage</span><span class="hljs-params">(String msg)</span> </span>{
        ...
    }
}
</code></pre>
                                    <p>Note that the above code stops the system when the multiplicity is violated. Alternatively, we can throw an exception and let the caller handle the situation.</p>
                                  </div>
                                </question>
                              </panel>
                            </div>
                            <div>
                              <panel header="<span class='glyphicon glyphicon-question-sign' aria-hidden='true'></span><span class='glyphicon glyphicon-ok-sign' aria-hidden='true'></span> Bidirectional association between `Bank` and `Account`">
                                <question has-input="true">
                                  <p>Implement this bidirectional association. Note that the <code>Bank</code> uses <code>accNumber</code> attribute to uniquely identify an <code>Account</code> object. Assume the <code>Bank</code> class is responsible for
                                    maintaining the links between objects.</p>
                                  <img src="/se-book/errorHandling/defensiveProgramming/referentialIntegrity/images/bankAccount.jpg" height="60">
                                  <p></p>
                                  <div slot="answer">
                                    <p>The code below contains a method in the <code>Bank</code> class to create an account; the bank field in the new account is thereby filled by the bank creating it.</p>
                                    <p>We assume that once an <code>Account</code> has been assigned to one <code>Bank</code>, it cannot be assigned to a different <code>Bank</code>. Once the <code>Account</code> is removed from the <code>Bank</code>, it
                                      will not be used any more (hence, no need to remove the link from <code>Account</code> to <code>Bank</code>).</p>
                                    <pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Account</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> accNumber ;
    <span class="hljs-keyword">private</span> Bank theBank ;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Account</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n, Bank b)</span> </span>{
        accno = n ;
        theBank = b ;
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getNumber</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> accNumber;
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> Bank <span class="hljs-title">getBank</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> theBank ;
    }
}
</code></pre>
                                    <pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.*;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Bank</span> </span>{
    <span class="hljs-keyword">private</span> HashMap&lt; Integer, Account &gt; theAccounts = <span class="hljs-keyword">new</span> HashMap &lt; Integer, Account &gt; ();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createAccount</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span> </span>{
        addAccount(<span class="hljs-keyword">new</span> Account(n, <span class="hljs-keyword">this</span>)) ;
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addAccount</span><span class="hljs-params">(Account a)</span> </span>{          
        theAccounts.put(a.getNumber(), a);
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeAccount</span><span class="hljs-params">(<span class="hljs-keyword">int</span> accNumber)</span> </span>{
        theAccounts.remove(accNumber);
    }
    <span class="hljs-function"><span class="hljs-keyword">public</span> Account <span class="hljs-title">lookupAccount</span><span class="hljs-params">(<span class="hljs-keyword">int</span> accNumber)</span> </span>{
        <span class="hljs-keyword">return</span> theAccounts.get(accNumber);
    }
}
</code></pre>
                                  </div>
                                </question>
                              </panel>
                            </div>
                            <div>
                              <panel header="<span class='glyphicon glyphicon-question-sign' aria-hidden='true'></span><span class='glyphicon glyphicon-ok-sign' aria-hidden='true'></span> Is the code defensive? `Teacher` and `Student`">
                                <question has-input="true">
                                  <p>(a) Is the code given below a defensive translation of the associations shown in the class diagram? Explain your answer.</p>
                                  <pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Teacher</span></span>{
    <span class="hljs-keyword">private</span> Student favoriteStudent;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setFavoriteStudent</span><span class="hljs-params">(Student s)</span></span>{
        favoriteStudent = s;
    }
}
</code></pre>
                                  <pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span></span>{
    <span class="hljs-keyword">private</span> Teacher favoriteTeacher;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setFavoriteTeacher</span><span class="hljs-params">(Teacher t)</span></span>{
        favoriteTeacher = t;
    }
}
</code></pre>
                                  <img src="/se-book/errorHandling/defensiveProgramming/referentialIntegrity/images/teacherStudent.png" height="80">
                                  <p></p>
                                  <p>(b) In terms of maintaining referential integrity in the implementation, what is the difference between the following two diagrams?</p>
                                  <img src="/se-book/errorHandling/defensiveProgramming/referentialIntegrity/images/teacherStudent.png" height="80">
                                  <p></p>
                                  <img src="/se-book/errorHandling/defensiveProgramming/referentialIntegrity/images/manWomanAssoc.png" height="60">
                                  <p></p>
                                  <p>(c) Show a defensive implementation of the <code>remove(Member m)</code> of the <code>Club</code> class given below.</p>
                                  <img src="/se-book/errorHandling/defensiveProgramming/referentialIntegrity/images/clubMember.png" height="60">
                                  <p></p>
                                  <div slot="answer">
                                    <p>(a) Yes. Each links is mutable and unidirectional. A simple reference variable is suitable to hold the link.</p>
                                    <p><code>Teacher</code> class can be made even more defensive by introducing a <code>resetFavoriteStudent()</code> method to unlink the current favorite student from a teacher. In that case, <code>setFavoriteStudent(Student)</code>                                      method should not accept null. This approach is more defensive because it prevents a null value being passed to <code>setFavoriteStudent(Student)</code> by mistake and being interpreted as a request to de-link the
                                      current favorite student from the <code>Teacher</code> object.</p>
                                    <p>(b) First diagram has unidirectional links. Second has a bidirectional link. RI is only applicable to the second.</p>
                                    <p>(c)</p>
                                    <pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">removeMember</span><span class="hljs-params">(Member m)</span> </span>{
    <span class="hljs-keyword">if</span> (m==<span class="hljs-keyword">null</span>) {
        <span class="hljs-keyword">throw</span> exception(<span class="hljs-string">"this is null, not a member!"</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(member_count == <span class="hljs-number">10</span>) {
        <span class="hljs-keyword">throw</span> exception(<span class="hljs-string">"we need at least 10 members to survive!"</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(!isMember(m)) {
        <span class="hljs-keyword">throw</span> exception (<span class="hljs-string">"this fellow is not a member of our club!"</span>);
    } <span class="hljs-keyword">else</span> {
        members.remove(m); <span class="hljs-comment">// members is a data structure such as ArrayList</span>
    }
}
</code></pre>
                                  </div>
                                </question>
                              </panel>
                            </div>
                            <div>
                              <panel header="<span class='glyphicon glyphicon-question-sign' aria-hidden='true'></span><span class='glyphicon glyphicon-ok-sign' aria-hidden='true'></span> True or False?">
                                <question>
                                  <p>Bidirectional associations, if not implemented properly, can result in referential integrity violations.</p>
                                  <ul radio-group="719bb" class="radio-list">
                                    <li class="radio-list-item"><label><input class="radio-list-input" name="719bb" type="radio"> True</label></li>
                                    <li class="radio-list-item"><label><input class="radio-list-input" name="719bb" type="radio"> False</label></li>
                                  </ul>
                                  <div slot="answer">
                                    <p>True</p>
                                    <p>Explanation: Bidirectional associations require two objects to link to each other. When one of these links is not consistent with the other, we have a referential integrity violation.</p>
                                  </div>
                                </question>
                              </panel>
                            </div>
                          </panel>
                        </div>
                      </div>
                    </div>
                  </panel>
                </div>
                <div>
                  <panel type="seamless" expanded="">
                    <span slot="header" class="card-title"><div>
<h4 id="when-3">When</h4></div></span>
                    <div class="indented">
                      <p><span class="badge badge-light"><span><span class="dimmed"><span><span class="fas fa-trophy"></span> Can explain when to use defensive programming</span>
                        </span>
                        </span>
                        </span>
                        <p></p>
                      </p>
                      <p></p>
                      <div>
                        <p><strong>It is not necessary to be 100% defensive all the time.</strong> While defensive code may be less prone to be misused or abused, such code can also be more complicated and slower to run.</p>
                        <p>The suitable degree of defensiveness depends on many factors such as:</p>
                        <ul>
                          <li>How critical is the system?</li>
                          <li>Will the code be used by programmers other than the author?</li>
                          <li>The level of programming language support for defensive programming</li>
                          <li>The overhead of being defensive</li>
                        </ul>
                      </div>
                      <div>
                        <div>
                          <panel header="<span class='fas fa-dumbbell'></span> Exercises" expandable="">
                            <div>
                              <panel header="<span class='glyphicon glyphicon-question-sign' aria-hidden='true'></span><span class='glyphicon glyphicon-ok-sign' aria-hidden='true'></span> Defensive programming">
                                <question>
                                  <p>Defensive programming,</p>
                                  <ul class="task-list">
                                    <li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox"> a. can make the program slower.</li>
                                    <li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox"> b. can make the code longer.</li>
                                    <li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox"> c. can make the code more complex.</li>
                                    <li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox"> d. can make the code less susceptible to misuse.</li>
                                    <li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox"> e. can require extra effort.</li>
                                  </ul>
                                  <div slot="answer">
                                    <p>(a)(b)(c)(d)(e)</p>
                                    <p>Explanation: Defensive programming requires a more checks, possibly making the code longer, more complex, and possibly slower. Use it only when benefits outweigh costs, which is often.</p>
                                  </div>
                                </question>
                              </panel>
                            </div>
                          </panel>
                        </div>
                      </div>
                    </div>
                  </panel>
                </div>
              </div>
            </panel>
          </div>
          <div>
            <panel type="seamless" expanded="">
              <span slot="header" class="card-title"><div>
<h2 id="design-by-contract-approach">Design-by-Contract Approach</h2></div></span>
              <div>
                <div>
                  <panel type="seamless" expanded="">
                    <span slot="header" class="card-title"><div>
<h4 id="design-by-contract">Design by Contract</h4></div></span>
                    <div class="indented">
                      <p><span class="badge badge-light"><span><span class="dimmed"><span><span class="fas fa-trophy"></span> Can explain the Design-by-Contract approach</span>
                        </span>
                        </span>
                        </span>
                        <p></p>
                      </p>
                      <p></p>
                      <div>
                        <p><strong><tooltip content="term was coined by Bertrand Meyer">Design by contract (DbC)</tooltip> is an approach for designing software that requires defining formal, precise and verifiable interface specifications for software components.</strong></p>
                        <p>Suppose an operation is implemented with the behavior specified precisely in the API (preconditions, post conditions, exceptions etc.). When following the defensive approach, the code should first check if the preconditions have
                          been met. Typically, exceptions are thrown if preconditions are violated. In contrast, the <em>Design-by-Contract (DbC)</em> approach to coding assumes that it is the responsibility of the caller to ensure all preconditions are
                          met. The operation will honor the contract only if the preconditions have been met. If any of them have not been met, the behavior of the operation is &quot;unspecified&quot;.</p>
                        <p>Languages such as Eiffel have native support for DbC. For example, preconditions of an operation can be specified in Eiffel and the language runtime will check precondition violations without the need to do it explicitly in the
                          code. To follow the DbC approach in languages such as Java and C++ where there is no built-in DbC support, assertions can be used to confirm pre-conditions.</p>
                      </div>
                      <div>
                        <div>
                          <panel header="<span class='fas fa-dumbbell'></span> Exercises" expandable="">
                            <div>
                              <panel header="<span class='glyphicon glyphicon-question-sign' aria-hidden='true'></span><span class='glyphicon glyphicon-ok-sign' aria-hidden='true'></span> Statements about the Design-by-contract approach?">
                                <question>
                                  <p>Which statements are correct?</p>
                                  <ul class="task-list">
                                    <li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox"> a. It is not natively supported by Java and C++.</li>
                                    <li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox"> b. It is an alternative to OOP.</li>
                                    <li class="task-list-item"><input class="task-list-item-checkbox" type="checkbox"> c. It assumes the caller of a method is responsible for ensuring all preconditions are met.</li>
                                  </ul>
                                  <div slot="answer">
                                    <p>(a)<s>(b)</s>(c)</p>
                                    <p>Explanation: DbC is not an alternative to OOP. We can use DbC in an OOP solution.</p>
                                  </div>
                                </question>
                              </panel>
                            </div>
                          </panel>
                        </div>
                      </div>
                    </div>
                  </panel>
                </div>
              </div>
            </panel>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="flex-div"></div>
<footer>
  <div class="text-center">
    <small>This site was built with <a href="https://markbind.github.io/markbind/">MarkBind 1.12.0</a> at Sun, 19 Aug 2018 12:17:58 GMT.</small></div>
</footer>
</div>
</body>
<script src="..\markbind\js\vue.min.js"></script>
<script src="..\markbind\js\vue-strap.min.js"></script>
<script src="..\markbind\js\polyfill.min.js"></script>
<script src="..\markbind\js\bootstrap-vue.min.js"></script>
<script>
    const baseUrl = '/se-book'
</script>
<script src="..\markbind\js\setup.js"></script>
</html>
